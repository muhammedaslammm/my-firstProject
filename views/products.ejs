<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Quicksand&family=Roboto:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link rel="stylesheet" href="/styles/nav.css" />

    <title>signup page</title>
    <style>
      /* page container */
      .sort-container {
        display: flex;
        width: 95%;
        margin: 80px auto 10px;
        justify-content: space-between;
      }
      .sort-section {
        width: 20%;
        display: flex;
        justify-content: end;
      }
      .sort-section form {
        width: 100%;
      }
      .sort-section select {
        border: 1px solid rgb(165, 163, 163);
        padding: 6px;
        width: 80%;
        margin-left: 2%;
        outline: none;
      }
      .sort-section select:hover {
        cursor: pointer;
      }
      .sort-container .count-section p {
        margin: 0;
        color: rgb(84, 84, 84);
      }
      .sort-container .count-section p span {
        font-size: 17px;
        font-weight: 500;
        color: black;
      }
      .page-container {
        width: 95%;
        margin: 0px auto;
        display: flex;
        justify-content: space-between;
      }
      .side-bar {
        display: flex;
        flex-direction: column;
        width: 12%;
        padding: 30px 15px;
        box-shadow: 0px 0px 9px rgb(207, 207, 207);
        background-color: white;
      }
      .side-bar .section-box {
        display: flex;
        flex-direction: column;
        margin-bottom: 17px;
      }
      .side-bar .section-box a {
        color: rgb(96, 95, 95);
        padding: 5px 1px;
        text-decoration: none;
        opacity: 0.8;
        transition: opacity 0.3s;
      }
      .side-bar #colors a {
        padding: 5px 5px;
      }
      .side-bar .section-box a:hover {
        color: black;
        text-decoration: none;
        opacity: 1;
      }
      .filter-tag.selected {
        font-weight: bold;
        color: black;
        opacity: 1;
      }
      .side-bar .section-box .head {
        font-weight: 500;
        margin-bottom: 5px;
      }

      /* main body */
      .container-body {
        padding: 30px 0px;
        width: 83%;
        margin: 0 auto;
        justify-content: center;
        display: grid;
        grid-template-columns: 260px 260px 260px 260px;
        grid-template-rows: 500px 500px 500px;
        grid-column-gap: 40px;
        grid-row-gap: 40px;
        background-color: white;
        box-shadow: 0px 0px 9px rgb(207, 207, 207);
      }
      .container-body a {
        text-decoration: none;
        color: black;
        height: auto;
      }
      .container-body a:hover {
        text-decoration: none;
        color: black;
      }
      /* product card */
      .product-card {
        transition: box-shadow 0.5s;
      }
      .product-card:hover {
        box-shadow: 0px 4px 8px 2px rgb(205, 205, 205);
      }
      img {
        width: 100%;
        object-fit: contain;
      }
      .details {
        padding: 10px 20px;
      }
      .description .brand {
        font-size: 20px;
        font-weight: 500;
      }
      .description .tagline {
        font-size: 17px;
        line-height: 21px;
        color: rgb(64, 63, 63);
      }
      .price {
        display: flex;
        margin-top: 12px;
        align-items: end;
      }
      .price .selling {
        font-size: 17px;
        font-weight: 500;
      }
      .price .actual {
        font-size: 16px;
        margin-left: 10px;
        margin-right: 7px;
        color: rgb(107, 105, 105);
        text-decoration: line-through;
        text-decoration-thickness: 1.3px;
        text-decoration-color: rgba(211, 35, 35, 0.805);
      }
      .price .discount {
        color: rgba(0, 128, 0, 0.997);
      }

      /* pagination */
      .pagination {
        width: 80%;
        margin: 20px auto 60px;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
      }

      .pagination a {
        text-decoration: none;
        color: rgb(12, 92, 12);
        font-weight: 500;
        font-size: 17px;
      }
    </style>
  </head>
  <body>
    <!-- header section -->
    <%-include('./partials/navbar.ejs')%>

    <!--  -->
    <div class="sort-container">
      <div class="count-section">
        <p>Total Count: <span><%=count%></span></p>
      </div>
      <div class="sort-section">
        <form action="return false">
          <select name="sort" id="sort" onchange="sortPage(event)">
            <option value="popularity">Popularity</option>
            <option value="new">New Arrival</option>
            <option value="low-high">Price Low to High</option>
            <option value="high-low">Price High to Low</option>
            <option value="name-asc">Name Ascending</option>
            <option value="name-desc">Name Descending</option>
            <option value="featured">Featured</option>
            <option value="avg-rating">Average Ratings</option>
          </select>
        </form>
      </div>
    </div>
    <div class="page-container">
      <div class="side-bar">
        <div class="section-box">
          <div class="head">CATEGORIES</div>
          <%categories.forEach(function(category){%>
          <a href="/category/<%=category%>"><%=category%></a>
          <%})%>
        </div>
        <div class="section-box">
          <div class="head">BRANDS</div>
          <%brands.forEach(function(brand){%> <%const selectedTag = brand ===
          query.brand%>
          <a
            href="/category/Tops"
            onclick="setFilter('brand','<%=brand%>',event)"
            class="filter-tag<%selectedTag ? 'selected' : ''%>"
            data-type="brand"
            data-value="<%=brand%>"
            ><%=brand%></a
          >
          <%})%>
        </div>

        <!-- sizes -->
        <div class="section-box">
          <div class="head">SIZES</div>
          <a
            href=""
            onclick="setFilter('size','extra_small',event)"
            data-type="size"
            data-value="extra_small"
            class="filter-tag"
            >Extra Small</a
          >
          <a
            href=""
            onclick="setFilter('size','small',event)"
            data-type="size"
            data-value="small"
            class="filter-tag"
            >Small</a
          >
          <a
            href=""
            onclick="setFilter('size','medium',event)"
            data-type="size"
            data-value="medium"
            class="filter-tag"
            >Medium</a
          >
          <a
            href=""
            onclick="setFilter('size','large',event)"
            data-type="size"
            data-value="large"
            class="filter-tag"
            >Large</a
          >
          <a
            href=""
            onclick="setFilter('size','extra_large',event)"
            data-type="size"
            data-value="extra_large"
            class="filter-tag"
            >Extra Large</a
          >
          <a
            href=""
            onclick="setFilter('size','extra_extra_large',event)"
            data-type="size"
            data-value="extra_extra_large"
            class="filter-tag"
            >XXL</a
          >
        </div>
        <div class="section-box">
          <div class="head">PRICE</div>
          <%const selectedTag = query.price === '0-1000'%>
          <a
            href=""
            onclick="setFilter('price','0-1000',event)"
            class="filter-tag<%selectedTag ? 'selected' : ''%>"
            data-type="price"
            data-value="0-1000"
            >Under Rs.1000</a
          >
          <a
            href=""
            onclick="setFilter('price','1000-2000',event)"
            class="filter-tag"
            data-type="price"
            data-value="1000-2000"
            >Rs.1000 - Rs.2000</a
          >
          <a
            href=""
            onclick="setFilter('price','2000-5000',event)"
            class="filter-tag"
            data-type="price"
            data-value="2000-5000"
            >Rs.2000 - Rs.5000</a
          >
          <a
            href=""
            onclick="setFilter('price','5000-10000',event)"
            class="filter-tag"
            data-type="price"
            data-value="5000-10000"
            >Rs.5000 - Rs.10000</a
          >
        </div>
        <div class="section-box" id="colors">
          <div class="head">COLORS</div>
          <a
            href=""
            style="background-color: rgb(209, 36, 36); color: white"
            onclick="setFilter('color','Red',event)"
            class="filter-tag"
            data-type="color"
            data-value="Red"
            >Red</a
          >
          <a
            href=""
            style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0)"
            onclick="setFilter('color','White',event)"
            class="filter-tag"
            data-type="color"
            data-value="White"
            >White</a
          >
          <a
            href=""
            style="background-color: rgb(28, 140, 18); color: white"
            onclick="setFilter('color','Green',event)"
            class="filter-tag"
            data-type="color"
            data-value="Green"
            >Green</a
          >
          <a
            href=""
            style="background-color: rgb(25, 137, 217); color: white"
            onclick="setFilter('color','Blue',event)"
            class="filter-tag"
            data-type="color"
            data-value="Blue"
            >Blue</a
          >
          <a
            href=""
            style="background-color: rgb(157, 209, 142); color: rgb(0, 0, 0)"
            onclick="setFilter('color','Pista',event)"
            class="filter-tag"
            data-type="color"
            data-value="Pista"
            >Pista</a
          >
          <a
            href=""
            style="background-color: rgb(0, 0, 0); color: white"
            onclick="setFilter('color','Black',event)"
            class="filter-tag"
            data-type="color"
            data-value="Black"
            >Black</a
          >
          <a
            href=""
            style="background-color: rgb(115, 115, 115); color: white"
            onclick="setFilter('color','grey',event)"
            class="filter-tag"
            data-type="color"
            data-value="Grey"
            >Grey</a
          >
        </div>
        <div class="section-box">
          <div class="head">RATINGS</div>
          <a href="">Above 4.5</a>
          <a href="">4.5 - 4.0</a>
          <a href="">4.0 - 3.0</a>
          <a href="">3.0 - 2.0</a>
        </div>
        <div class="section-box">
          <div class="head">DISCOUNT</div>
          <a href="">10% and more</a>
          <a href="">20% and more</a>
          <a href="">30% and more</a>
          <a href="">40% and more</a>
        </div>
      </div>
      <div class="container-body">
        <% if(products.length > 0){%> <% products.forEach(function(product){%>
        <a
          href="/category/<%=product.category%>/<%=product._id%>"
          class="product-link"
        >
          <div class="product-card">
            <div class="image">
              <img src="<%=product.images[0]%>" alt="product image" />
            </div>
            <div class="details">
              <div class="description">
                <div class="brand"><%=product.brand%></div>
                <div class="tagline">
                  <%=product.color%> <%=product.pattern%> Men's
                  <%=product.fabric%> <%=product.productType%>
                </div>
              </div>
              <div class="price">
                <div class="selling">
                  Rs. <%=product.productOffer ?
                  product.productOffer.sellingPrice : product.sellingPrice%>
                </div>
                <div class="actual">Rs. <%=product.actualPrice%></div>
                <div class="discount">
                  <%=product.productOffer ? product.productOffer.offer :
                  product.discount%>%off
                </div>
              </div>
            </div>
          </div>
        </a>
        <% }) %> <%}%>
      </div>
    </div>
    <div class="pagination">
      <%if(currentPage>1){%>
      <a href="/category/<%=params.categoryName%>?page=<%=currentPage-1%>"
        >back</a
      >
      <%}%>
      <div class="currentPage"><%=currentPage%></div>
      <%if(currentPage < totalPages){%>
      <a href="/category/<%=params.categoryName%>?page=<%=currentPage+1%>"
        >next</a
      >
      <%}%>
    </div>

    <script>
      // sorting logic
      function sortPage(event) {
        // event.preventDefault();
        const sortBy = event.target.value;
        const URLParams = new URLSearchParams(window.location.search);
        URLParams.set("sort", sortBy);
        window.location.search = URLParams.toString();
      }

      function setFilter(filterBy, value, event) {
        event.preventDefault();
        const urlParams = new URLSearchParams(window.location.search);

        const selected = urlParams.get(filterBy) === value;

        if (selected) {
          localStorage.removeItem(filterBy);
          urlParams.delete(filterBy);
        } else {
          localStorage.removeItem(filterBy);
          urlParams.set(filterBy, value);
          localStorage.setItem(filterBy, value);
        }
        window.location.search = urlParams.toString();
      }

      document.addEventListener("DOMContentLoaded", function () {
        const tags = document.querySelectorAll(".filter-tag");
        tags.forEach(function (filterTag) {
          const filterType = filterTag.dataset.type;
          const filterValue = filterTag.dataset.value;

          if (filterType === "color") {
            if (localStorage.getItem(filterTag) === filterValue) {
              filterTag.style.opacity = "1";
            }
          } else {
            if (localStorage.getItem(filterType) === filterValue) {
              filterTag.style.fontWeight = "500";
              filterTag.style.color = "black";
              filterTag.style.opacity = "1";
            }
          }
        });
      });

      const profileButton = document.querySelector("#profile-button");
      const content = document.querySelector(".dropdown-content");

      profileButton.addEventListener("click", function (event) {
        event.preventDefault();
        content.style.display =
          content.style.display === "none" ? "block" : "none";
      });

      // set select attribute in options
      document.addEventListener("DOMContentLoaded", function () {
        const sortSelect = document.querySelector("#sort");
        const sortValue = "<%=query.sort%>";

        if (sortValue) {
          const optionArray = Array.from(sortSelect.options);
          optionArray.forEach(function (option) {
            if (option.value === sortValue) {
              option.selected = true;
            }
          });
        }
        localStorage.removeItem("selectedSize");
      });
    </script>
    <script
      src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
      integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
